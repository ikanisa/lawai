# Repository Deep Analysis Task Board

The following board captures the highest-value fixes identified while reviewing the Law.ai monorepo. Each line links to a pre-filled GitHub issue so maintainers can kick off implementation immediately.

| # | Area | Issue Summary | Impact | Start |
| --- | --- | --- | --- | --- |
| 1 | API bootstrap | `createApp` disables TypeScript with `// @ts-nocheck`, so Fastify plugins and context wiring are invisible to the compiler. | Regressions in server wiring are caught only at runtime, risking production outages when routes change. | [Start Task](../../issues/new?title=Restore%20Fastify%20bootstrap%20typing&body=##%20Summary%0A-%20Remove%20%60%2F%2F%20%40ts-nocheck%60%20from%20%60apps%2Fapi%2Fsrc%2Fapp.ts%60%20and%20restore%20strong%20typing%20for%20Fastify%20instances.%0A-%20Tighten%20generic%20parameters%20so%20domain%20route%20register%20helpers%20share%20the%20correct%20%60AppContext%60.%0A-%20Backfill%20tests%20ensuring%20the%20typed%20app%20exposes%20expected%20route%20prefixes.%0A##%20Acceptance%20Criteria%0A-%20TypeScript%20build%20passes%20without%20%60@ts-nocheck%60.%0A-%20Unit%20tests%20cover%20app%20factory%20and%20workspace%20domain%20registration.%0A) |
| 2 | Workspace domain | `/api/workspace` still executes a placeholder query against `agent_runs` even though the aggregation helpers already exist in `server.ts`. | Workspace dashboards miss jurisdiction, compliance, and HITL telemetry, blocking launch-readiness reviews. | [Start Task](../../issues/new?title=Wire%20workspace%20overview%20route%20to%20service&body=##%20Summary%0A-%20Move%20the%20real%20workspace%20aggregation%20logic%20from%20%60apps%2Fapi%2Fsrc%2Fserver.ts%60%20into%20%60domain%2Fworkspace%2Froutes.ts%60.%0A-%20Inject%20a%20service%20layer%20and%20propagate%20structured%20errors.%0A-%20Add%20integration%20tests%20covering%20happy%20and%20Supabase-failure%20paths.%0A##%20Acceptance%20Criteria%0A-%20Route%20returns%20full%20workspace%20overview%20payload.%0A-%20Server%20logs%20meaningful%20errors%20and%20maps%20them%20to%20status%20codes.%0A) |
| 3 | Compliance + rate limits | Compliance acknowledgements, SCIM, and SSO handlers still live inside `server.ts`, and only telemetry endpoints leverage the in-memory limiter. | Centralised handlers are hard to test and sensitive routes are exposed to abuse without distributed throttling. | [Start Task](../../issues/new?title=Modularize%20compliance%20domain%20and%20extend%20rate%20limits&body=##%20Summary%0A-%20Extract%20compliance%20acknowledgement%20handlers%20into%20a%20dedicated%20domain%20module.%0A-%20Adopt%20shared%20rate-limiter%20middleware%20(ideally%20Redis-backed)%20across%20compliance%2C%20run-execution%2C%20and%20auth-sensitive%20routes.%0A-%20Update%20tests%20to%20target%20the%20new%20module%20and%20assert%20limit%20enforcement.%0A##%20Acceptance%20Criteria%0A-%20Compliance%20routes%20live%20under%20domain%20modules.%0A-%20Rate%20limits%20cover%20all%20public%2Fsensitive%20paths.%0A) |
| 4 | Web auth context | The web client hard-codes `DEMO_ORG_ID`/`DEMO_USER_ID` in API helpers and React queries, so every operator shares a fake tenant. | No request carries real tenant context, breaking multi-org support, audit trails, and telemetry accuracy. | [Start Task](../../issues/new?title=Plumb%20authenticated%20org%2Fuser%20context%20into%20web%20API%20client&body=##%20Summary%0A-%20Introduce%20session%20resolution%20(via%20Supabase%20auth%20or%20Next.js%20middleware)%20to%20derive%20%60orgId%60%20and%20%60userId%60.%0A-%20Refactor%20API%20helpers%20and%20UI%20callers%20to%20use%20real%20IDs%20instead%20of%20demo%20constants.%0A-%20Add%20empty-state%20handling%20for%20unauthenticated%20operators.%0A##%20Acceptance%20Criteria%0A-%20No%20remaining%20references%20to%20demo%20IDs%20in%20runtime%20code.%0A-%20Web%20requests%20carry%20real%20tenant%20context.%0A) |
| 5 | PWA rollout | `AppProviders` registers the service worker on every mount with no environment or user gating. | Forced Workbox installs complicate debugging and risk stale assets in regulated deployments. | [Start Task](../../issues/new?title=Gate%20PWA%20registration%20behind%20opt-in&body=##%20Summary%0A-%20Add%20a%20client%20flag%20(e.g.%20%60NEXT_PUBLIC_ENABLE_PWA%60)%20and%20user%20gesture%20before%20calling%20%60registerPwa%60.%0A-%20Ensure%20SSR%20paths%20skip%20Workbox%20imports%20when%20disabled.%0A-%20Extend%20tests%20to%20cover%20disabled%20state%20and%20document%20the%20flag.%0A##%20Acceptance%20Criteria%0A-%20Service%20worker%20loads%20only%20when%20flag%20and%20user%20opt-in%20are%20true.%0A-%20Docs%20explain%20how%20to%20enable%20PWA%20in%20production.%0A) |
| 6 | Supabase seeds | `db/seed/seed.ts` and `francophone-lex/db/seed/seed.ts` diverge by hand, duplicating large payloads that regularly fall out of sync. | Seed drift produces inconsistent tenants between environments and makes schema evolution brittle. | [Start Task](../../issues/new?title=Deduplicate%20Supabase%20seed%20scripts&body=##%20Summary%0A-%20Extract%20shared%20seed%20data%20into%20a%20single%20module%20consumed%20by%20both%20seed%20scripts.%0A-%20Add%20type-safe%20builders%20so%20jurisdictions%2C%20entitlements%2C%20and%20templates%20cannot%20diverge.%0A-%20Wire%20the%20scripts%20into%20CI%20to%20assert%20they%20remain%20in%20lockstep.%0A##%20Acceptance%20Criteria%0A-%20One%20authoritative%20seed%20source%20shared%20across%20projects.%0A-%20CI%20check%20fails%20if%20seed%20snapshots%20drift.%0A) |

## Additional Opportunities

- **Launch documentation** – Cross-link `docs/DEEP_RESEARCH_GUIDE.md` from deployment guides so applied researchers can discover it without manual file digging.
- **Domain test coverage** – Add regression suites under `apps/api/test` for each module in `apps/api/src/domain/*`, where coverage is currently absent.
- **Telemetry hardening** – Expand observability spans and metrics for workspace aggregations and compliance workflows while extracting them from `server.ts`.
